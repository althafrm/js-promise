<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"
        defer></script>
    <title>JS Promises</title>
</head>

<body>
    <div class="form-control">
        <div class="button-group mb-4">
            Select promise type:
            <button id="call-promise-one" class="btn btn-primary" onclick="callPromiseOne()">One</button>
            <button id="call-promise-all" class="btn btn-primary" onclick="callPromiseAll()">All</button>
            <button id="call-promise-race" class="btn btn-primary" onclick="callPromiseRace()">Race</button>
        </div>
        <div>
            <div class="mb-4">
                Promise type: <span id="promise-type">-</span>
            </div>
            <div class="mb-4">
                Promise count: <span id="promise-count">-</span>
            </div>
            <div class="mb-4">
                Response time: <span id="response-time">-</span>
            </div>
        </div>
        <span hidden id="random"></span>
    </div>

    <script type="application/javascript">
        // Basics
        const offset = 1, limit = 2;
        const random = Math.floor(
            Math.random() * (limit + 1)
        ) + offset; // min: 1, max: 1 + 2 = 3
        console.log('random', random);

        document.getElementById('random').innerText = random;

        let promise = new Promise((resolve, reject) => {
            if (random <= 5) resolve(random);
            else reject(random);
        });

        promise.then((response) => console.log('promise success', response))
            .catch((error) => console.log('promise failure', error));

        function callPromise() {
            return new Promise((resolve, reject) => {
                if (random < 5) resolve(random);
                else reject(random);
            });
        }

        callPromise()
            .then(response => console.log('success callPromise', response))
            .catch(error => console.log('failure callPromise', error));

        let promise1 = new Promise((resolve, reject) => {
            setTimeout(() => {
                console.log('promise1-random:', random);
                resolve('promise1');
            }, (random) * 1000);
        });

        let promise2 = new Promise((resolve, reject) => {
            setTimeout(() => {
                console.log('promise2-random:', random);
                resolve('promise2');
            }, (random * 1.5) * 1000);
        });

        let promise3 = new Promise((resolve, reject) => {
            setTimeout(() => {
                console.log('promise3-random:', random);
                resolve('promise3');
            }, (random * 2) * 1000);
        });

        const startAll = performance.now();
        Promise.all([promise1, promise2, promise3])
            .then(response => {
                const endAll = performance.now();
                console.log('all-time', Math.floor((endAll - startAll) / 1000) + ' seconds');
            }).catch(error => console.error(error));

        const startRace = performance.now();
        Promise.race([promise1, promise2, promise3])
            .then(response => {
                const endRace = performance.now();
                console.log('race-time', Math.floor((endRace - startRace) / 1000) + ' seconds');
            }).catch(error => console.error(error));

        // UI
        function generateRandomNumber() {
            const offset = 1, limit = 2;
            const random = Math.floor(
                Math.random() * (limit + 1)
            ) + offset; // min: 1, max: 1 + 2 = 3

            return random;
        }

        function getPromise() {
            const time = generateRandomNumber();

            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(time);
                }, time * 1000);
            });
        }

        function setValue(field, value) {
            document.getElementById(field).innerText = value;
        }

        function callPromiseOne() {
            const promise = getPromise();

            setValue('promise-type', 'one');
            setValue('promise-count', 1);
            setValue('response-time', 'processing...');

            const start = performance.now();
            promise.then(response => {
                const end = performance.now();
                setValue('response-time', Math.floor((end - start) / 1000) + ' seconds');
            }).catch(error => console.error(error));
        }

        function callPromiseAll() {
            const promiseCount = 3;
            let promises = [];

            for (let i = 0; i < promiseCount; i++) {
                promises.push(getPromise());
            }

            setValue('promise-type', 'all');
            setValue('promise-count', promiseCount);
            setValue('response-time', 'processing...');

            const start = performance.now();
            Promise.all(promises)
                .then(response => {
                    const end = performance.now();
                    setValue('response-time', Math.floor((end - start) / 1000) + ' seconds');
                }).catch(error => console.error(error));
        }

        function callPromiseRace() {
            const promiseCount = 3;
            let promises = [];

            for (let i = 0; i < promiseCount; i++) {
                promises.push(getPromise());
            }

            setValue('promise-type', 'race');
            setValue('promise-count', promiseCount);
            setValue('response-time', 'processing...');

            const start = performance.now();
            Promise.race(promises)
                .then(response => {
                    const end = performance.now();
                    setValue('response-time', Math.floor((end - start) / 1000) + ' seconds');
                }).catch(error => console.error(error));
        }
    </script>
</body>

<!--
reference:
https://stackoverflow.com/questions/4959975/generate-random-number-between-two-numbers-in-javascript#24152886
https://stackoverflow.com/questions/313893/how-to-measure-time-taken-by-a-function-to-execute
https://stackoverflow.com/questions/24928846/get-return-value-from-settimeout
-->

</html>